version: 0.78.1

type: DeclarativeSource

check:
  type: CheckStream
  stream_names:
    - case

definitions:
  streams:
    case:
      type: DeclarativeStream
      name: case
      primary_key:
        - ID
      retriever:
        type: SimpleRetriever
        requester:
          $ref: '#/definitions/base_requester'
          path: >-
            GetCases?searchData.exportFields=CaseID&searchData.exportFields=Position&searchData.exportFields=ProjectLevel&searchData.exportFields=DateOccurred&searchData.exportFields=DatePublished&searchData.exportFields=Deadline&searchData.exportFields=DateClosed&searchData.exportFields=CaseType&searchData.exportFields=SeverityDegree&searchData.exportFields=Description&searchData.exportFields=Comments&searchData.exportFields=Originator&searchData.exportFields=Approver&searchData.exportFields=OriginatorEmployeeNumber&searchData.exportFields=OrganizationLevel3&searchData.exportFields=Status&searchData.exportFields=KPIParameters&searchData.exportFields=SeverityDegree&searchData.exportFields=ImmediateActions&searchData.exportFields=Actions
          http_method: GET
          request_headers:
            OL1Key: nrcnorge
        record_selector:
          type: RecordSelector
          extractor:
            type: DpathExtractor
            field_path: []
      schema_loader:
        type: InlineSchemaLoader
        schema:
          $ref: '#/schemas/case'
  base_requester:
    type: HttpRequester
    url_base: https://tqm5api.tqmenterprise.no/nrcnorge/CaseHandling/External/Cases/
    authenticator:
      type: SessionTokenAuthenticator
      login_requester:
        type: HttpRequester
        url_base: https://tqm5api.tqmenterprise.no/nrcnorge/Authenticate
        path: ExternalAuthenticate
        authenticator:
          type: NoAuth
        http_method: POST
        request_parameters: {}
        request_headers:
          OL1Key: nrcnorge
          Authorization: "basic {{ config['token'] }}"
      session_token_path:
        - Token
      request_authentication:
        type: ApiKey
        inject_into:
          type: RequestOption
          field_name: Token
          inject_into: header

streams:
  - $ref: '#/definitions/streams/case'

spec:
  type: Spec
  connection_specification:
    type: object
    $schema: http://json-schema.org/draft-07/schema#
    required:
      - token
    properties:
      token:
        type: string
        description: Token for authentication with TQM API
        order: 0
        title: Token
        airbyte_secret: true
    additionalProperties: true

metadata:
  autoImportSchema:
    case: true

schemas:
  case:
    type: object
    $schema: http://json-schema.org/schema#
    properties:
      Actions:
        type:
          - array
          - 'null'
        items:
          type:
            - object
            - 'null'
          properties:
            ActionOwner:
              type:
                - object
                - 'null'
              properties:
                ID:
                  type:
                    - number
                    - 'null'
                Login:
                  type:
                    - string
                    - 'null'
                Name:
                  type:
                    - string
                    - 'null'
            ActionStatus:
              type:
                - string
                - 'null'
            Deadline:
              type:
                - string
                - 'null'
            ExecutedActions:
              type:
                - string
                - 'null'
            ID:
              type:
                - number
                - 'null'
            Name:
              type:
                - string
                - 'null'
            PlannedActions:
              type:
                - string
                - 'null'
            RootCause:
              type:
                - string
                - 'null'
      Attachments:
        type:
          - array
          - 'null'
      CaseID:
        type:
          - number
          - 'null'
      CaseType:
        type:
          - object
          - 'null'
        properties:
          ID:
            type:
              - number
              - 'null'
          Name:
            type:
              - string
              - 'null'
      CaseURL:
        type:
          - string
          - 'null'
      Comments:
        type:
          - string
          - 'null'
      CustomFields:
        type:
          - array
          - 'null'
      DateClosed:
        type:
          - string
          - 'null'
      DateOccurred:
        type:
          - string
          - 'null'
      DatePublished:
        type:
          - string
          - 'null'
      Deadline:
        type:
          - string
          - 'null'
      Description:
        type:
          - string
          - 'null'
      ID:
        type: number
      ImmediateActions:
        type:
          - string
          - 'null'
      KPIParameters:
        type:
          - array
          - 'null'
        items:
          type:
            - object
            - 'null'
          properties:
            ID:
              type:
                - number
                - 'null'
            Name:
              type:
                - string
                - 'null'
      KPIWarnings:
        type:
          - array
          - 'null'
      OrganizationLevel3:
        type:
          - object
          - 'null'
        properties:
          ID:
            type:
              - number
              - 'null'
          Name:
            type:
              - string
              - 'null'
      Originator:
        type:
          - object
          - 'null'
        properties:
          ID:
            type:
              - number
              - 'null'
          Login:
            type:
              - string
              - 'null'
          Name:
            type:
              - string
              - 'null'
      OriginatorEmployeeNumber:
        type:
          - string
          - 'null'
      Position:
        type:
          - string
          - 'null'
      ProcessLevels:
        type:
          - array
          - 'null'
      ProgressLogs:
        type:
          - array
          - 'null'
      ProjectLevel:
        type:
          - object
          - 'null'
        properties:
          FullPath:
            type:
              - string
              - 'null'
          ID:
            type:
              - number
              - 'null'
          Name:
            type:
              - string
              - 'null'
      RiskMeasurements:
        type:
          - array
          - 'null'
      SeparateKPIParameters:
        type:
          - array
          - 'null'
      Status:
        type:
          - object
          - 'null'
        properties:
          Key:
            type:
              - string
              - 'null'
          Name:
            type:
              - string
              - 'null'
    required:
      - ID
    additionalProperties: true
